<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="ZXing for JS">

  <title>ZXing TypeScript | Decoding from camera stream</title>


  <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
    href="https://unpkg.com/normalize.css@8.0.0/normalize.css">
  <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
    href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css">
</head>

<body>

  <input type="text" onfocusout="if(this.Value.lenght<=2) this.Value = ''">

  <main class="wrapper" style="padding-top:2em">

    <section class="container" id="demo-content">
      

      <div>
        <a class="button" id="ZXZ" onclick="scanner('result')">ESCRIBIR EN 1</a>
        <!-- <a class="button" id="startButton">Start</a> -->
        <a class="button" id="resetButton">Reset</a>
      </div>
      <div>
        <a class="button" id="ZXZ" onclick="scanner('result2')">ESCRIBIR EN DOS</a>
        <!-- <a class="button" id="startButton">Start</a> -->
        <!-- <a class="button" id="resetButton">Reset</a> -->
      </div>

      <div>
        <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
      </div>

      <div id="sourceSelectPanel" style="display:none">
        <label for="sourceSelect">Change video source:</label>
        <select id="sourceSelect" style="max-width:400px">
        </select>
      </div>

      <label>Result:</label>
      RESULTADO 1<pre><code id="result"></code></pre>
      RESULTADO 2<pre><code id="result2"></code></pre>

    </section>


  </main>

  <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
  <script type="text/javascript">

    // window.addEventListener('load', function () {
const scanner=(sdestino)=>{
    let selectedDeviceId;
    videoInputDevices = [];
      const codeReader = new ZXing.BrowserMultiFormatReader()
      console.log('ZXing code reader initialized')
      codeReader.listVideoInputDevices()
        .then((videoInputDevices) => {
          const sourceSelect = document.getElementById('sourceSelect')
          selectedDeviceId = videoInputDevices[0].deviceId
          if (videoInputDevices.length >= 1) {
            videoInputDevices.forEach((element) => {
              const sourceOption = document.createElement('option')
              sourceOption.text = element.label
              sourceOption.value = element.deviceId
              sourceSelect.appendChild(sourceOption)
            })

            sourceSelect.onchange = () => {
              selectedDeviceId = sourceSelect.value;
              alert("cambio camaraasads", selectedDeviceId);
            };

            const sourceSelectPanel = document.getElementById('sourceSelectPanel')
            sourceSelectPanel.style.display = 'block'
          }

        //   document.getElementById('startButton').addEventListener('click', () => {
            codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
              if (result) {
                console.log(result)
                document.getElementById(sdestino).textContent = result.text
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err)
                document.getElementById(sdestino).textContent = err
              }
            })
            console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
        //   })

          document.getElementById('resetButton').addEventListener('click', () => {
            codeReader.reset()
            document.getElementById('result').textContent = '';
            console.log('Reset.')
          })

        })
        .catch((err) => {
          console.error(err)
        })
}
    // })
  </script>

</body>

</html>


<!-- 
onKeyDown="if(this.value.length>1) return false;" onfocusout="if(this.value.length<=2) this.value=''"   onchange="controlMostrarOtro('text_8_107','text_35_107','OTRO')"
 -->



<script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>

<!-- 

var BarcodeIsRunning = false;
var QrIsRunning = false;
var leido = false;
let scanner;
var destinobarra;

function QR(destino) {

    StopLectura();
    $('#lector').show();
    $('#lector').text('Lector QR');
    $('#btncancelar').show();
    $('#modalCodigoBitacora').modal('show');

    QrIsRunning = true;
    $('#preview').show();
    $('#preview').width(280);
    //$('#preview').height(280);
    scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });

    Instascan.Camera.getCameras().then(function (cameras) {
        //ok(cameras.length)
        if (cameras.length > 0) {
            scanner.start(cameras[0]);
        }
        //else if (cameras.length == 1) {
        //    scanner.start(cameras[0]);
        //}
        else {
            msgerror('No hay camaras disponibles.');
        }
    }).catch(function (e) {
        msgerror('No hay camaras disponibles.');
    });



    scanner.addListener('scan', function (content) {
        var texto = $('#' + destino).val();
        $('#' + destino).val(texto + ' ' + content);
        scanner.stop();
        QrIsRunning = false;
        $('#preview').hide();
        $('#modalCodigoBitacora').modal('hide');

    });

}

function BARCODE(destinoB) {

    StopLectura();
    $('#lector').show();
    $('#lector').text('Lector Barras');
    $('#btncancelar').show();
    $('#modalCodigoBitacora').modal('show');

    destinobarra = destinoB;

    Quagga.init({
        inputStream: {
            name: "Live",
            type: "LiveStream",
            target: document.querySelector('#barcode'),
            constraints: {
                width: 280,
                height: 280,
                facing: "environment"
            },
            //constraints: {
            //    deviceId: dev[0].deviceId
            //},
        },
        decoder: {
            readers: [
                "code_128_reader",
                "ean_reader",
                "ean_8_reader",
                "code_39_reader",
                "code_39_vin_reader",
                "codabar_reader",
                "upc_reader",
                "upc_e_reader",
                "i2of5_reader"
            ],
            debug: {
                showCanvas: false,
                showPatches: false,
                showFoundPatches: false,
                showSkeleton: false,
                showLabels: false,
                showPatchLabels: false,
                showRemainingPatchLabels: false,
                boxFromPatches: {
                    showTransformed: false,
                    showTransformedBox: false,
                    showBB: false
                }
            }
        },

    }, function (err) {
        if (err) {
            console.log(err);
            BARCODE(destinoB);
            return
        }

        //console.log("Initialization finished. Ready to start");
        Quagga.start();
        //document.getElementById("barcode").style.display = 'block';
        $('#barcode').show();

        // Set flag to is running
        BarcodeIsRunning = true;
    });

    Quagga.onDetected(function (result) {

        destinoB = destinobarra;

        if (!leido) {
            leido = true;
            Confirmar('Lector', 'El codigo: ' + result.codeResult.code + ' es correcto?', function () {

                var texto = $('#' + destinoB).val();
                $('#' + destinoB).val(texto + ' ' + result.codeResult.code);
                $('#barcode').hide();
                Quagga.stop();
                BarcodeIsRunning = false;
                $('#lector').hide();
                $('#btncancelar').hide();
                leido = false;
                destinoB = undefined;
                $('#modalCodigoBitacora').modal('hide');
            }, function () { leido = false; destinoB = undefined; });
        }
    });

}

function StopLectura() {
    
    $('#lector').hide();
    $('#btncancelar').hide();
    
    if (BarcodeIsRunning) {
        Quagga.stop();
        BarcodeIsRunning = false;
        $('#barcode').hide();
        $('#modalCodigoBitacora').modal('hide');
        //$('#barcode').empty();
    }

    if (QrIsRunning) {
        scanner.stop();
        QrIsRunning = false;
        $('#preview').hide();
        $('#modalCodigoBitacora').modal('hide');
        //$('#preview').empty();
    }
} -->
